import{_ as V,r as _,s as B,q,o as I,c as S,e as a,f as n,g as e,x as T,j as D,t as o,h as b,y as w,F as p,p as h}from"./index-DwGMUA94.js";import{H as M}from"./Header-C1mrxC1h.js";import{a as C,g as E}from"./settlementApi-Wlj3dVhR.js";const F={class:"view-wrapper"},H={class:"settlement-view"},P={key:0,class:"content-container loading"},U={key:1,class:"content-container error"},$={key:2,class:"content-container"},j={class:"summary-header"},x={class:"trip-name"},z={class:"total-amount"},G={class:"settlement-card"},J={class:"card-header"},K=["value"],O={class:"transaction-list"},Q={key:0},W={class:"member-info"},X={class:"avatar bg-theme-secondary"},Y={class:"amount"},Z={key:1,class:"empty-message"},ee={class:"settlement-card"},te={class:"card-header"},se=["value"],ae={class:"transaction-list"},ne={key:0},oe={class:"member-info"},re={class:"avatar bg-theme-primary"},le={class:"amount"},ie={key:1,class:"empty-message"},ce={__name:"SettlementRequestView",setup(ue){const r=_(null),y=_(!0),u=_(null),c=_(null),A=B(),f=q(),d=A.params.tripId,L=()=>{f.push(`/settlement/${d}`)};I(async()=>{const i=new Promise(s=>setTimeout(s,700));try{const[s,t]=await Promise.all([C(d),E(d),i]),l=s.data||[],N=t.data;if(!Array.isArray(l)){console.error("settlements is not an array:",l),u.value="정산 데이터 형식이 올바르지 않습니다.";return}if(l.length===0){u.value="아직 정산이 생성되지 않았습니다. 정산을 먼저 생성해주세요.";return}const m=new Set;l.forEach(v=>{v.senderNickname&&m.add(v.senderNickname),v.receiverNickname&&m.add(v.receiverNickname)}),r.value={settlements:l,members:Array.from(m),tripName:N.tripName,totalAmount:N.totalAmount,transactions:l},Array.from(m).length>0&&(c.value=Array.from(m)[0])}catch(s){console.error("정산 정보 로딩 실패:",s),console.error("에러 상세:",s.response?.data),s.response?.status===403?u.value="그룹장만 정산을 조회할 수 있습니다.":u.value="데이터를 불러오는 데 실패했습니다."}finally{y.value=!1}});const k=S(()=>r.value?.settlements?r.value.settlements.filter(i=>i.receiverNickname===c.value):[]),g=S(()=>r.value?.settlements?r.value.settlements.filter(i=>i.senderNickname===c.value):[]),R=async()=>{if(confirm("정산 내역을 확인하러 가시겠습니까?"))try{f.push(`/settlement/${d}/detail`)}catch(i){console.error("페이지 이동 실패:",i),alert("페이지 이동에 실패했습니다.")}};return(i,s)=>(n(),a("div",F,[e("div",H,[T(M,{title:"정산하기","back-action":L}),y.value?(n(),a("main",P,s[2]||(s[2]=[e("p",null,"최종 정산 결과를 계산하는 중...",-1)]))):u.value?(n(),a("main",U,[e("p",null,o(u.value),1)])):r.value?(n(),a("main",$,[e("div",j,[e("p",x,o(r.value.tripName),1),e("h2",z," 총 "+o(r.value.totalAmount?.toLocaleString()||0)+"원 사용 ",1)]),e("div",G,[e("div",J,[b(e("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>c.value=t),class:"member-select"},[(n(!0),a(p,null,h(r.value.members,t=>(n(),a("option",{key:t,value:t},o(t),9,K))),128))],512),[[w,c.value]]),s[3]||(s[3]=e("span",{class:"card-title"},"님이 받을 돈",-1))]),e("div",O,[k.value.length>0?(n(),a("div",Q,[(n(!0),a(p,null,h(k.value,(t,l)=>(n(),a("div",{key:l,class:"transaction-item"},[e("div",W,[e("div",X,[e("span",null,o(t.senderNickname.substring(0,1)),1)]),e("span",null,o(t.senderNickname),1)]),e("span",Y,o(t.amount.toLocaleString())+"원",1)]))),128))])):(n(),a("p",Z,"받을 돈이 없습니다."))])]),e("div",ee,[e("div",te,[b(e("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>c.value=t),class:"member-select"},[(n(!0),a(p,null,h(r.value.members,t=>(n(),a("option",{key:t,value:t},o(t),9,se))),128))],512),[[w,c.value]]),s[4]||(s[4]=e("span",{class:"card-title"},"님이 보낼 돈",-1))]),e("div",ae,[g.value.length>0?(n(),a("div",ne,[(n(!0),a(p,null,h(g.value,(t,l)=>(n(),a("div",{key:l,class:"transaction-item"},[e("div",oe,[e("div",re,[e("span",null,o(t.receiverNickname.substring(0,1)),1)]),e("span",null,o(t.receiverNickname),1)]),e("span",le,o(t.amount.toLocaleString())+"원",1)]))),128))])):(n(),a("p",ie,"보낼 돈이 없습니다."))])])])):D("",!0),e("footer",{class:"footer"},[e("button",{onClick:R,class:"next-button"}," 정산 요청 보내기 ")])])]))}},_e=V(ce,[["__scopeId","data-v-90bd8c59"]]);export{_e as default};
