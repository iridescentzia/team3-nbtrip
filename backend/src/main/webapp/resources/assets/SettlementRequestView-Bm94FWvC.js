import{_ as V,r as _,s as q,q as B,o as I,c as S,e as a,f as n,g as e,x as T,j as D,t as r,h as b,y as w,F as p,p as h}from"./index-ByWhX96s.js";import{H as M}from"./Header-DqGpCHyQ.js";import{a as $,g as C,r as E}from"./settlementApi-Bb9doJmR.js";const F={class:"view-wrapper"},H={class:"settlement-view"},P={key:0,class:"content-container loading"},U={key:1,class:"content-container error"},j={key:2,class:"content-container"},x={class:"summary-header"},z={class:"trip-name"},G={class:"total-amount"},J={class:"settlement-card"},K={class:"card-header"},O=["value"],Q={class:"transaction-list"},W={key:0},X={class:"member-info"},Y={class:"avatar bg-theme-secondary"},Z={class:"amount"},ee={key:1,class:"empty-message"},te={class:"settlement-card"},se={class:"card-header"},ae=["value"],ne={class:"transaction-list"},oe={key:0},re={class:"member-info"},le={class:"avatar bg-theme-primary"},ie={class:"amount"},ce={key:1,class:"empty-message"},ue={__name:"SettlementRequestView",setup(me){const l=_(null),y=_(!0),u=_(null),c=_(null),A=q(),f=B(),m=A.params.tripId,L=()=>{f.push(`/settlement/${m}`)};I(async()=>{const o=new Promise(s=>setTimeout(s,700));try{const[s,t]=await Promise.all([$(m),C(m),o]),i=s.data||[],N=t.data;if(!Array.isArray(i)){console.error("settlements is not an array:",i),u.value="정산 데이터 형식이 올바르지 않습니다.";return}if(i.length===0){u.value="아직 정산이 생성되지 않았습니다. 정산을 먼저 생성해주세요.";return}const d=new Set;i.forEach(v=>{v.senderNickname&&d.add(v.senderNickname),v.receiverNickname&&d.add(v.receiverNickname)}),l.value={settlements:i,members:Array.from(d),tripName:N.tripName,totalAmount:N.totalAmount,transactions:i},Array.from(d).length>0&&(c.value=Array.from(d)[0])}catch(s){console.error("정산 정보 로딩 실패:",s),console.error("에러 상세:",s.response?.data),s.response?.status===403?u.value="그룹장만 정산을 조회할 수 있습니다.":u.value="데이터를 불러오는 데 실패했습니다."}finally{y.value=!1}});const k=S(()=>l.value?.settlements?l.value.settlements.filter(o=>o.receiverNickname===c.value):[]),g=S(()=>l.value?.settlements?l.value.settlements.filter(o=>o.senderNickname===c.value):[]),R=async()=>{if(confirm("모든 멤버에게 정산 요청을 보낼까요?"))try{await E({tripId:m}),alert("정산 요청을 성공적으로 보냈습니다!"),f.push(`/settlement/${m}/detail`)}catch(o){console.error("정산 요청 실패:",o),console.error("에러 상세:",o.response?.data),o.response?.data?.message?alert(`정손 요청 실패: ${o.response.data.message}`):alert("정산 요청에 실패했습니다.")}};return(o,s)=>(n(),a("div",F,[e("div",H,[T(M,{title:"정산하기","back-action":L}),y.value?(n(),a("main",P,s[2]||(s[2]=[e("p",null,"최종 정산 결과를 계산하는 중...",-1)]))):u.value?(n(),a("main",U,[e("p",null,r(u.value),1)])):l.value?(n(),a("main",j,[e("div",x,[e("p",z,r(l.value.tripName),1),e("h2",G," 총 "+r(l.value.totalAmount?.toLocaleString()||0)+"원 사용 ",1)]),e("div",J,[e("div",K,[b(e("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>c.value=t),class:"member-select"},[(n(!0),a(p,null,h(l.value.members,t=>(n(),a("option",{key:t,value:t},r(t),9,O))),128))],512),[[w,c.value]]),s[3]||(s[3]=e("span",{class:"card-title"},"님이 받을 돈",-1))]),e("div",Q,[k.value.length>0?(n(),a("div",W,[(n(!0),a(p,null,h(k.value,(t,i)=>(n(),a("div",{key:i,class:"transaction-item"},[e("div",X,[e("div",Y,[e("span",null,r(t.senderNickname.substring(0,1)),1)]),e("span",null,r(t.senderNickname),1)]),e("span",Z,r(t.amount.toLocaleString())+"원",1)]))),128))])):(n(),a("p",ee,"받을 돈이 없습니다."))])]),e("div",te,[e("div",se,[b(e("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>c.value=t),class:"member-select"},[(n(!0),a(p,null,h(l.value.members,t=>(n(),a("option",{key:t,value:t},r(t),9,ae))),128))],512),[[w,c.value]]),s[4]||(s[4]=e("span",{class:"card-title"},"님이 보낼 돈",-1))]),e("div",ne,[g.value.length>0?(n(),a("div",oe,[(n(!0),a(p,null,h(g.value,(t,i)=>(n(),a("div",{key:i,class:"transaction-item"},[e("div",re,[e("div",le,[e("span",null,r(t.receiverNickname.substring(0,1)),1)]),e("span",null,r(t.receiverNickname),1)]),e("span",ie,r(t.amount.toLocaleString())+"원",1)]))),128))])):(n(),a("p",ce,"보낼 돈이 없습니다."))])])])):D("",!0),e("footer",{class:"footer"},[e("button",{onClick:R,class:"next-button"}," 정산 요청 보내기 ")])])]))}},pe=V(ue,[["__scopeId","data-v-9f0af4b7"]]);export{pe as default};
