import{_ as w,r as c,s as L,q as V,o as R,c as y,e as a,f as n,g as e,x as q,j as B,t as o,h as k,z as g,F as u,p as d}from"./index-GM-NJavN.js";import{H as D}from"./Header-Grlpcz_d.js";import{c as F,r as I}from"./settlementApi-CTAtlKn0.js";const M={class:"view-wrapper"},C={class:"settlement-view"},H={key:0,class:"content-container loading"},P={key:1,class:"content-container error"},T={key:2,class:"content-container"},U={class:"summary-header"},j={class:"trip-name"},x={class:"total-amount"},z={class:"settlement-card"},A={class:"card-header"},E=["value"],G={class:"transaction-list"},J={key:0},K={class:"member-info"},O={class:"avatar bg-theme-secondary"},Q={class:"amount"},W={key:1,class:"empty-message"},X={class:"settlement-card"},Y={class:"card-header"},Z=["value"],$={class:"transaction-list"},ee={key:0},te={class:"member-info"},se={class:"avatar bg-theme-primary"},ae={class:"amount"},ne={key:1,class:"empty-message"},oe={__name:"SettlementRequestView",setup(le){const l=c(null),_=c(!0),m=c(null),r=c(null),b=L(),S=V(),p=b.params.tripId;R(async()=>{const i=new Promise(t=>setTimeout(t,700));try{const[t]=await Promise.all([F(p),i]);l.value=t.data,t.data&&t.data.members&&t.data.members.length>0&&(r.value=t.data.members[0])}catch(t){console.error("최종 정산 정보 로딩 실패:",t),m.value="데이터를 불러오는 데 실패했습니다."}finally{_.value=!1}});const h=y(()=>!l.value||!r.value?[]:l.value.transactions.filter(i=>i.receiverNickname===r.value)),f=y(()=>!l.value||!r.value?[]:l.value.transactions.filter(i=>i.senderNickname===r.value)),N=async()=>{if(confirm("모든 멤버에게 정산 요청을 보낼까요?"))try{await I({tripId:p}),alert("정산 요청을 성공적으로 보냈습니다!"),S.push("/")}catch(i){console.error("정산 요청 실패:",i),alert("정산 요청에 실패했습니다.")}};return(i,t)=>(n(),a("div",M,[e("div",C,[q(D,{title:"정산하기"}),_.value?(n(),a("main",H,t[2]||(t[2]=[e("p",null,"최종 정산 결과를 계산하는 중...",-1)]))):m.value?(n(),a("main",P,[e("p",null,o(m.value),1)])):l.value?(n(),a("main",T,[e("div",U,[e("p",j,o(l.value.tripName),1),e("h2",x," 총 "+o(l.value.totalAmount?.toLocaleString()||0)+"원 사용 ",1)]),e("div",z,[e("div",A,[k(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>r.value=s),class:"member-select"},[(n(!0),a(u,null,d(l.value.members,s=>(n(),a("option",{key:s,value:s},o(s),9,E))),128))],512),[[g,r.value]]),t[3]||(t[3]=e("span",{class:"card-title"},"님이 받을 돈",-1))]),e("div",G,[h.value.length>0?(n(),a("div",J,[(n(!0),a(u,null,d(h.value,(s,v)=>(n(),a("div",{key:v,class:"transaction-item"},[e("div",K,[e("div",O,[e("span",null,o(s.senderNickname.substring(0,1)),1)]),e("span",null,o(s.senderNickname),1)]),e("span",Q,o(s.amount.toLocaleString())+"원",1)]))),128))])):(n(),a("p",W,"받을 돈이 없습니다."))])]),e("div",X,[e("div",Y,[k(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>r.value=s),class:"member-select"},[(n(!0),a(u,null,d(l.value.members,s=>(n(),a("option",{key:s,value:s},o(s),9,Z))),128))],512),[[g,r.value]]),t[4]||(t[4]=e("span",{class:"card-title"},"님이 보낼 돈",-1))]),e("div",$,[f.value.length>0?(n(),a("div",ee,[(n(!0),a(u,null,d(f.value,(s,v)=>(n(),a("div",{key:v,class:"transaction-item"},[e("div",te,[e("div",se,[e("span",null,o(s.receiverNickname.substring(0,1)),1)]),e("span",null,o(s.receiverNickname),1)]),e("span",ae,o(s.amount.toLocaleString())+"원",1)]))),128))])):(n(),a("p",ne,"보낼 돈이 없습니다."))])])])):B("",!0),e("footer",{class:"footer"},[e("button",{onClick:N,class:"next-button"}," 정산 요청 보내기 ")])])]))}},ue=w(oe,[["__scopeId","data-v-aba7f324"]]);export{ue as default};
