<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.scoula.paymentlist.mapper.PaymentListMapper">

    <!-- VO 필드 매핑 -->
    <resultMap id="PaymentListResultMap" type="org.scoula.paymentlist.domain.PaymentListVO">
        <result property="merchantId" column="merchantId"/>
        <result property="merchantName" column="merchantName"/>
        <result property="categoryId" column="categoryId"/>
        <result property="categoryName" column="categoryName"/>
        <result property="userId" column="userId"/>
        <result property="nickname" column="nickname"/>
        <result property="payAt" column="payAt"/>
        <result property="amount" column="amount"/>
        <result property="paymentType" column="paymentType"/>
        <result property="memo" column="memo"/>
    </resultMap>

    <!-- 결제 내역 불러오기 -->
    <select id="selectPaymentList"
            parameterType="int"
            resultMap="PaymentListResultMap">
        SELECT
            m.merchant_id AS merchantId,
            m.merchant_name AS merchantName,
            mc.category_id AS categoryId,
            mc.category_name AS categoryName,
            u.user_id AS userId,
            u.nickname AS nickname,
            p.pay_at AS payAt,
            p.amount,
            p.payment_type AS paymentType,
            p.memo
        FROM payment p
                JOIN users u ON p.user_id = u.user_id
                JOIN merchant m ON p.merchant_id = m.merchant_id
                JOIN merchant_category mc ON m.category_id = mc.category_id
        WHERE p.trip_id = #{tripId}
        ORDER BY p.pay_at desc;
    </select>
</mapper>